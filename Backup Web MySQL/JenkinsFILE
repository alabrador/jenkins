pipeline {
    agent any

    stages {
        stage('Descargar respaldo') {
            steps {
                script {
                    withCredentials([
                        string(credentialsId: 'DB_NAME_SECRET', variable: 'DB_NAME'),
                        string(credentialsId: 'REMOTE_HOST_APRONTO', variable: 'REMOTE_HOST'),
                        string(credentialsId: 'REMOTE_PORT_APRONTO', variable: 'REMOTE_PORT')
                    ]) {
                        sh """
                            echo "Conectando al host remoto..."
                            echo "Base de datos: \$DB_NAME"
                            echo "Host remoto: \$REMOTE_HOST"
                            echo "Puerto remoto: \$REMOTE_PORT"

                            scp -P \$REMOTE_PORT -o StrictHostKeyChecking=no root@\$REMOTE_HOST:/tmp/\$DB_NAME*.sql.gz backups/
                        """
                    }
                }
            }
        }
    }
}
